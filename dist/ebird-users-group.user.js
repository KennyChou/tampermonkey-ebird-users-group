// ==UserScript==
// @name         ebird-users-group
// @namespace    https://kennychou.github.io/2022/05/04/TamperMonkey-for-eBird-%E8%85%B3%E6%9C%AC/
// @version      1.0.0
// @description  eBird Share from group
// @author       Kenny Chou
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_setClipboard
// @grant        GM_info
// @grant        GM_xmlhttpRequest
// @grant        GM.getValue
// @grant        GM.setValue
// @grant        GM.setClipboard
// @grant        GM_info
// @grant        GM.xmlHttpRequest
// @require      https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.min.js
// @match        https://ebird.org/checklist/*
// @match        https://ebird.org/taiwan/checklist/*
// ==/UserScript==

!function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e){t.exports=Vue},function(t,e,s){"use strict";s.r(e);var i=s(0),a=s.n(i),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"share-groups-fieldset"}},[e("div",[e("div",{attrs:{hidden:t.editMode}},[t._m(0),t._v(" "),e("div",{staticClass:"u-stack-sm",staticStyle:{"background-color":"white","max-height":"8rem","overflow-y":"auto","box-shadow":"inset 0 1px 2px rgba(33,33,33,.1)",border:"1px solid #d3d3d3"},attrs:{id:"share-group"}},[0==t.groups.length?[e("a",{staticClass:"u-inset-squish-sm",staticStyle:{display:"block","border-bottom":"1px solid #efefef"},attrs:{href:"#share-recipients"},on:{click:t.addAll}},[t._v("全部成員")])]:[t._l(t.groups,(function(s,i){return[e("span",{staticClass:"u-inset-squish-sm",staticStyle:{display:"block","border-bottom":"1px solid #efefef"}},[e("a",{attrs:{href:"#share-recipients"},on:{click:function(e){return t.shareGroup(s.ebirdIds)}}},[t._v(t._s(s.name))]),t._v(" "),e("a",{staticStyle:{float:"right"},attrs:{href:"#share-groups-fieldset"},on:{click:function(e){return t.editGroup(i)}}},[t._v("編輯")])])]}))]],2),t._v(" "),e("p",{staticClass:"u-text-2"},[e("a",{attrs:{href:"#share-groups-fieldset"},on:{click:function(e){return t.editGroup(-1)}}},[t._v("新增群組")])])]),t._v(" "),e("div",{attrs:{id:"user-group-editor",hidden:!t.editMode}},[t._m(1),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editData.name,expression:"editData.name"}],staticClass:"u-text-2",attrs:{type:"text"},domProps:{value:t.editData.name},on:{input:function(e){e.target.composing||t.$set(t.editData,"name",e.target.value)}}}),t._v(" "),e("span",{staticClass:"Heading-sub Heading-sub--inline"},[t._v("(用戶名稱或電子郵件地址，以逗號分隔)")]),t._v(" "),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.editData.ebirdIds,expression:"editData.ebirdIds"}],staticClass:"u-text-2",attrs:{id:"ebird-users-group"},domProps:{value:t.editData.ebirdIds},on:{input:function(e){e.target.composing||t.$set(t.editData,"ebirdIds",e.target.value)}}}),t._v(" "),e("div",{staticClass:"u-stack-sm",staticStyle:{"background-color":"white","max-height":"8rem","overflow-y":"auto","box-shadow":"inset 0 1px 2px rgba(33,33,33,.1)",border:"1px solid #d3d3d3"},attrs:{id:"share-contacts"}},[t._l(t.users,(function(s){return[e("a",{staticClass:"u-inset-squish-sm",staticStyle:{display:"block","border-bottom":"1px solid #efefef"},attrs:{href:"#share-groups-fieldset"},on:{click:function(e){return t.appendGroup(s)}}},[t._v(t._s(s.name))])]}))],2),t._v(" "),e("div",{staticClass:"ButtonGroup",staticStyle:{"margin-bottom":"20px"}},[e("button",{staticClass:"Button Button--small Button--highlight u-inline-sm",attrs:{disabled:""==this.editData.name.trim()||""==this.editData.ebirdIds.trim()},on:{click:t.saveGroups}},[t._v("存檔")]),t._v(" "),e("button",{staticClass:"Button Button--small Button--secondary u-inline-sm",on:{click:function(e){t.editMode=!1}}},[t._v("取消")]),t._v(" "),-1!=t.editId?e("button",{staticClass:"Button Button--small Button--secondary",on:{click:t.deleteGroup}},[t._v("刪除")]):t._e()]),t._v(" "),e("span",[t._v(" ")])])])])};r._withStripped=!0;var n=function(t,e,s,i,a,r,n,o){var d,u="function"==typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=s,u._compiled=!0),i&&(u.functional=!0),r&&(u._scopeId="data-v-"+r),n?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},u._ssrRegister=d):a&&(d=o?function(){a.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:a),d)if(u.functional){u._injectStyles=d;var l=u.render;u.render=function(t,e){return d.call(e),l(t,e)}}else{var c=u.beforeCreate;u.beforeCreate=c?[].concat(c,d):[d]}return{exports:t,options:u}}({name:"app",data:()=>({editMode:!1,users:[],editId:-1,groups:[],editData:{name:"",ebirdIds:""}}),mounted(){{const t=document.getElementById("share-contacts").getElementsByClassName("u-inset-squish-sm");for(const e of t)this.users.push({name:e.text,id:e.getAttribute("onclick",0).toString().split("'")[1]})}try{this.groups=JSON.parse(localStorage.getItem("ebird-groups")||"[]")}catch(t){console.log(t)}},methods:{addAll(){document.getElementById("share-recipients").value=this.users.map(t=>t.id).join(",")},editGroup(t){this.editId=t,-1==t?(this.editData.name="群組名稱",this.editData.ebirdIds=""):(this.editData.name=this.groups[t].name,this.editData.ebirdIds=this.groups[t].ebirdIds),this.editMode=!0},appendGroup(t){let e;e=""!=this.editData.ebirdIds.trim()?this.editData.ebirdIds.split(",").map(t=>t.trim()):[],e.includes(t.id)||e.push(t.id),this.editData.ebirdIds=e.join(",")},saveGroups(){-1==this.editId?this.groups.push({name:this.editData.name,ebirdIds:this.editData.ebirdIds}):(this.groups[this.editId].name=this.editData.name,this.groups[this.editId].ebirdIds=this.editData.ebirdIds),localStorage.setItem("ebird-groups",JSON.stringify(this.groups)),this.editId=-1,this.editMode=!1},deleteGroup(){this.groups.splice(this.editId,1),localStorage.setItem("ebird-groups",JSON.stringify(this.groups)),this.editId=-1,this.editMode=!1},shareGroup(t){document.getElementById("share-recipients").value=t}}},r,[function(){var t=this._self._c;return t("span",{staticClass:"Heading Heading--h6",attrs:{for:"share-group"}},[t("span",{staticClass:"Heading-main"},[this._v("群組通訊錄")])])},function(){var t=this._self._c;return t("span",{staticClass:"Heading Heading--h6",attrs:{for:"share-group"}},[t("span",{staticClass:"Heading-main"},[this._v("編輯群組")])])}],!1,null,null,null).exports;const o="app_vue_"+Date.now(),d=document.createElement("div");d.id=o;document.getElementById("share-contacts-fieldset").after(d);new a.a({el:"#"+o,render:t=>t(n)})}]);